<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - ReServe</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <span>ReServe</span>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="donation.html" class="nav-link">Donate</a></li>
                <li><a href="about.html" class="nav-link">About</a></li>
                <li><a href="contact.html" class="nav-link">Contact</a></li>
                <li><a href="rewards.html" class="nav-link">Rewards</a></li>
                <li><a href="welcome.html" class="nav-link">Login</a></li>
                <li><a href="settings.html" class="nav-link active">Settings</a></li>
            </ul>
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Settings Hero Section -->
    <section class="settings-hero">
        <div class="container">
            <div class="settings-hero-content">
                <h1>Account Settings</h1>
                <p>Manage your profile, preferences, and account settings</p>
            </div>
        </div>
    </section>

    <!-- Settings Content -->
    <section class="settings-section">
        <div class="container">
            <div class="settings-grid">
                <!-- Settings Sidebar -->
                <div class="settings-sidebar">
                    <div class="settings-nav">
                        <button class="settings-nav-item active" data-tab="profile">
                            <i class="fas fa-user"></i>
                            <span>Profile</span>
                        </button>
                        <button class="settings-nav-item" data-tab="notifications">
                            <i class="fas fa-bell"></i>
                            <span>Notifications</span>
                        </button>
                        <button class="settings-nav-item" data-tab="privacy">
                            <i class="fas fa-shield-alt"></i>
                            <span>Privacy & Security</span>
                        </button>
                        <button class="settings-nav-item" data-tab="preferences">
                            <i class="fas fa-cog"></i>
                            <span>Preferences</span>
                        </button>
                        <button class="settings-nav-item" data-tab="donation-settings">
                            <i class="fas fa-heart"></i>
                            <span>Donation Settings</span>
                        </button>
                        <button class="settings-nav-item" data-tab="account">
                            <i class="fas fa-key"></i>
                            <span>Account</span>
                        </button>
                    </div>
                </div>

                <!-- Settings Content Area -->
                <div class="settings-content">
                    <!-- Profile Settings -->
                    <div class="settings-tab active" id="profile">
                        <div class="settings-header">
                            <h2><i class="fas fa-user"></i> Profile Information</h2>
                            <p>Update your personal information and profile details</p>
                        </div>

                        <!-- User Profile Info from Backend -->
                        <div class="user-backend-profile" style="margin-bottom:1.5rem; background:#eaf6ff; border-radius:8px; padding:1rem 1.5rem;">
                            <p><strong>Username:</strong> <span id="profileUsername"></span></p>
                            <p><strong>Email:</strong> <span id="profileEmail"></span></p>
                            <p><strong>Registered At:</strong> <span id="profileCreated"></span></p>
                            <p><strong>Number of Donations:</strong> <span id="profileDonations"></span></p>
                        </div>

                        <!-- User Details Card -->
                        <div class="user-details-card" style="display: flex; align-items: flex-start; gap: 2rem; margin-bottom: 2rem; background: #f8f9fa; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); padding: 1.5rem 2rem;">
                            <div style="flex-shrink:0;">
                                <img id="details-profile-pic" src="images/default-avatar.png" alt="Profile Picture" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 2px solid #e0e0e0;">
                            </div>
                            <div>
                                <h3 id="details-full-name" style="margin: 0 0 0.5rem 0; font-size: 1.5rem;">John Doe</h3>
                                <p id="details-email" style="margin: 0 0 0.5rem 0; color: #666;">john.doe@email.com</p>
                                <div id="details-bio" style="font-size: 1rem; color: #444;">Passionate about helping others through donations and community service.</div>
                            </div>
                        </div>
                        
                        <form class="settings-form">
                            <div class="form-section">
                                <h3>Personal Information</h3>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="first-name">First Name *</label>
                                        <input type="text" id="first-name" name="firstName" value="John" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="last-name">Last Name *</label>
                                        <input type="text" id="last-name" name="lastName" value="Doe" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="email">Email Address *</label>
                                        <input type="email" id="email" name="email" value="john.doe@email.com" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="phone">Phone Number</label>
                                        <input type="tel" id="phone" name="phone" value="(555) 123-4567">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="bio">Bio</label>
                                    <textarea id="bio" name="bio" rows="3" placeholder="Tell us about yourself...">Passionate about helping others through donations and community service.</textarea>
                                </div>
                            </div>

                            <div class="form-section">
                                <h3>Location Information</h3>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="city">City *</label>
                                        <input type="text" id="city" name="city" value="New York" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="state">State *</label>
                                        <input type="text" id="state" name="state" value="NY" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="address">Address</label>
                                    <input type="text" id="address" name="address" value="123 Main Street">
                                </div>
                            </div>

                            <div class="form-section">
                                <h3>Profile Picture</h3>
                                <div class="profile-picture-section">
                                    <div class="profile-picture">
                                        <img src="images/default-avatar.png" alt="Profile Picture" id="profile-pic">
                                        <div class="profile-picture-overlay">
                                            <i class="fas fa-camera"></i>
                                        </div>
                                    </div>
                                    <div class="profile-picture-actions">
                                        <button type="button" class="btn-secondary">Upload New Photo</button>
                                        <button type="button" class="btn-text">Remove Photo</button>
                                    </div>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn-primary">Save Changes</button>
                                <button type="button" class="btn-secondary">Cancel</button>
                            </div>
                        </form>
                    </div>

                    <!-- Notification Settings -->
                    <div class="settings-tab" id="notifications">
                        <div class="settings-header">
                            <h2><i class="fas fa-bell"></i> Notification Preferences</h2>
                            <p>Choose how and when you want to be notified</p>
                        </div>
                        
                        <div class="settings-form">
                            <div class="form-section">
                                <h3>Email Notifications</h3>
                                <div class="notification-option">
                                    <div class="notification-info">
                                        <h4>Donation Matches</h4>
                                        <p>Get notified when someone is interested in your donations</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="notification-option">
                                    <div class="notification-info">
                                        <h4>Pickup Reminders</h4>
                                        <p>Receive reminders about scheduled donation pickups</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="notification-option">
                                    <div class="notification-info">
                                        <h4>Rewards & Points</h4>
                                        <p>Get updates about your points and available rewards</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="notification-option">
                                    <div class="notification-info">
                                        <h4>Community Updates</h4>
                                        <p>Stay informed about community events and news</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>

                            <div class="form-section">
                                <h3>Push Notifications</h3>
                                <div class="notification-option">
                                    <div class="notification-info">
                                        <h4>Enable Push Notifications</h4>
                                        <p>Receive instant notifications on your device</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>

                            <div class="form-section">
                                <h3>Notification Frequency</h3>
                                <div class="form-group">
                                    <label for="notification-frequency">Email Frequency</label>
                                    <select id="notification-frequency" name="frequency">
                                        <option value="immediate">Immediate</option>
                                        <option value="daily" selected>Daily Digest</option>
                                        <option value="weekly">Weekly Summary</option>
                                        <option value="never">Never</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn-primary">Save Preferences</button>
                            </div>
                        </div>
                    </div>

                    <!-- Privacy & Security Settings -->
                    <div class="settings-tab" id="privacy">
                        <div class="settings-header">
                            <h2><i class="fas fa-shield-alt"></i> Privacy & Security</h2>
                            <p>Manage your privacy settings and account security</p>
                        </div>
                        
                        <div class="settings-form">
                            <div class="form-section">
                                <h3>Privacy Settings</h3>
                                <div class="privacy-option">
                                    <div class="privacy-info">
                                        <h4>Profile Visibility</h4>
                                        <p>Make your profile visible to other users</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="privacy-option">
                                    <div class="privacy-info">
                                        <h4>Donation History</h4>
                                        <p>Show your donation history to other users</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="privacy-option">
                                    <div class="privacy-info">
                                        <h4>Location Sharing</h4>
                                        <p>Share your general location for better matching</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>

                            <div class="form-section">
                                <h3>Security Settings</h3>
                                <div class="form-group">
                                    <label for="current-password">Current Password</label>
                                    <input type="password" id="current-password" name="currentPassword">
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="new-password">New Password</label>
                                        <input type="password" id="new-password" name="newPassword">
                                    </div>
                                    <div class="form-group">
                                        <label for="confirm-password">Confirm New Password</label>
                                        <input type="password" id="confirm-password" name="confirmPassword">
                                    </div>
                                </div>
                                <div class="security-option">
                                    <div class="security-info">
                                        <h4>Two-Factor Authentication</h4>
                                        <p>Add an extra layer of security to your account</p>
                                    </div>
                                    <button type="button" class="btn-secondary">Enable 2FA</button>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn-primary">Save Security Settings</button>
                            </div>
                        </div>
                    </div>

                    <!-- Preferences Settings -->
                    <div class="settings-tab" id="preferences">
                        <div class="settings-header">
                            <h2><i class="fas fa-cog"></i> General Preferences</h2>
                            <p>Customize your ReServe experience</p>
                        </div>
                        
                        <div class="settings-form">
                            <div class="form-section">
                                <h3>Display Preferences</h3>
                                <div class="form-group">
                                    <label for="language">Language</label>
                                    <select id="language" name="language">
                                        <option value="en" selected>English</option>
                                        <option value="es">Spanish</option>
                                        <option value="fr">French</option>
                                        <option value="de">German</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="timezone">Timezone</label>
                                    <select id="timezone" name="timezone">
                                        <option value="EST" selected>Eastern Time (EST)</option>
                                        <option value="CST">Central Time (CST)</option>
                                        <option value="MST">Mountain Time (MST)</option>
                                        <option value="PST">Pacific Time (PST)</option>
                                    </select>
                                </div>
                                <div class="preference-option">
                                    <div class="preference-info">
                                        <h4>Dark Mode</h4>
                                        <p>Use dark theme for better viewing in low light</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>

                            <div class="form-section">
                                <h3>Donation Preferences</h3>
                                <div class="form-group">
                                    <label for="donation-radius">Preferred Donation Radius</label>
                                    <select id="donation-radius" name="radius">
                                        <option value="5">5 miles</option>
                                        <option value="10" selected>10 miles</option>
                                        <option value="25">25 miles</option>
                                        <option value="50">50 miles</option>
                                    </select>
                                </div>
                                <div class="preference-option">
                                    <div class="preference-info">
                                        <h4>Auto-Match Donations</h4>
                                        <p>Automatically match your donations with nearby recipients</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn-primary">Save Preferences</button>
                            </div>
                        </div>
                    </div>

                    <!-- Donation Settings -->
                    <div class="settings-tab" id="donation-settings">
                        <div class="settings-header">
                            <h2><i class="fas fa-heart"></i> Donation Settings</h2>
                            <p>Manage your donation preferences and history</p>
                        </div>
                        
                        <div class="settings-form">
                            <div class="form-section">
                                <h3>Donation Categories</h3>
                                <div class="category-preferences">
                                    <div class="category-option">
                                        <div class="category-info">
                                            <h4>Food Donations</h4>
                                            <p>Receive notifications for food donation opportunities</p>
                                        </div>
                                        <label class="toggle-switch">
                                            <input type="checkbox" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                    <div class="category-option">
                                        <div class="category-info">
                                            <h4>Clothing Donations</h4>
                                            <p>Receive notifications for clothing donation opportunities</p>
                                        </div>
                                        <label class="toggle-switch">
                                            <input type="checkbox" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                    <div class="category-option">
                                        <div class="category-info">
                                            <h4>Baby Items</h4>
                                            <p>Receive notifications for baby item donation opportunities</p>
                                        </div>
                                        <label class="toggle-switch">
                                            <input type="checkbox">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h3>Donation History</h3>
                                <div class="donation-stats">
                                    <div class="stat-card">
                                        <div class="stat-icon">
                                            <i class="fas fa-tshirt"></i>
                                        </div>
                                        <div class="stat-info">
                                            <h4>Total Donations</h4>
                                            <span class="stat-number">47</span>
                                        </div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-icon">
                                            <i class="fas fa-users"></i>
                                        </div>
                                        <div class="stat-info">
                                            <h4>Families Helped</h4>
                                            <span class="stat-number">23</span>
                                        </div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-icon">
                                            <i class="fas fa-star"></i>
                                        </div>
                                        <div class="stat-info">
                                            <h4>Current Rank</h4>
                                            <span class="stat-text">Gold</span>
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="btn-secondary">View Full History</button>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn-primary">Save Donation Settings</button>
                            </div>
                        </div>
                    </div>

                    <!-- Account Settings -->
                    <div class="settings-tab" id="account">
                        <div class="settings-header">
                            <h2><i class="fas fa-key"></i> Account Management</h2>
                            <p>Manage your account settings and data</p>
                        </div>
                        
                        <div class="settings-form">
                            <div class="form-section">
                                <h3>Account Information</h3>
                                <div class="account-info">
                                    <div class="info-item">
                                        <span class="info-label">Member Since:</span>
                                        <span class="info-value">March 2024</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Account Status:</span>
                                        <span class="info-value status-active">Active</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Last Login:</span>
                                        <span class="info-value">Today at 2:30 PM</span>
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h3>Data Management</h3>
                                <div class="data-actions">
                                    <div class="action-item">
                                        <div class="action-info">
                                            <h4>Download My Data</h4>
                                            <p>Get a copy of all your data from ReServe</p>
                                        </div>
                                        <button type="button" class="btn-secondary">Download</button>
                                    </div>
                                    <div class="action-item">
                                        <div class="action-info">
                                            <h4>Delete Account</h4>
                                            <p>Permanently delete your account and all data</p>
                                        </div>
                                        <button type="button" class="btn-danger">Delete Account</button>
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h3>Connected Accounts</h3>
                                <div class="connected-accounts">
                                    <div class="account-connection">
                                        <div class="connection-info">
                                            <i class="fab fa-google"></i>
                                            <div>
                                                <h4>Google</h4>
                                                <p>Connected for sign-in</p>
                                            </div>
                                        </div>
                                        <button type="button" class="btn-text">Disconnect</button>
                                    </div>
                                    <div class="account-connection">
                                        <div class="connection-info">
                                            <i class="fab fa-facebook"></i>
                                            <div>
                                                <h4>Facebook</h4>
                                                <p>Not connected</p>
                                            </div>
                                        </div>
                                        <button type="button" class="btn-secondary">Connect</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>ReServe</h3>
                    <p>Connecting communities through food and clothing donations.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="donation.html">Donate</a></li>
                        <li><a href="about.html">About</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Volunteer</a></li>
                        <li><a href="#">Partnership</a></li>
                        <li><a href="#">Donate</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact</h4>
                    <p><i class="fas fa-envelope"></i> reserve2025@gmail.com</p>
                    <p><i class="fas fa-phone"></i> (555) 123-4567</p>
                    <p><i class="fas fa-map-marker-alt"></i> 123 Charity St, City, State</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 ReServe. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
    // Fetch and display user profile info from backend
    document.addEventListener('DOMContentLoaded', function() {
        const token = localStorage.getItem('jwt_token') || '';
        if (!token) return;
        fetch('/api/profile', {
            headers: { 'Authorization': 'Bearer ' + token }
        })
        .then(res => res.json())
        .then(profile => {
            document.getElementById('profileUsername').textContent = profile.username || '';
            document.getElementById('profileEmail').textContent = profile.email || '';
            document.getElementById('profileCreated').textContent = profile.createdAt ? new Date(profile.createdAt).toLocaleString() : '';
            document.getElementById('profileDonations').textContent = profile.donationCount !== undefined ? profile.donationCount : '0';
        })
        .catch(() => {
            document.getElementById('profileUsername').textContent = 'Not logged in';
            document.getElementById('profileEmail').textContent = '';
            document.getElementById('profileCreated').textContent = '';
            document.getElementById('profileDonations').textContent = '';
        });
    });
    </script>
    <script src="script.js"></script>
    <script>
        // Settings tab navigation
        document.addEventListener('DOMContentLoaded', function() {
            const navItems = document.querySelectorAll('.settings-nav-item');
            const tabs = document.querySelectorAll('.settings-tab');

            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Remove active class from all nav items and tabs
                    navItems.forEach(nav => nav.classList.remove('active'));
                    tabs.forEach(tab => tab.classList.remove('active'));
                    
                    // Add active class to clicked nav item and corresponding tab
                    this.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                });
            });

            // Profile Picture Upload Functionality
            setupProfilePictureUpload();

            // User Details Card setup
            setupUserDetailsCard();

            // Form submission handling
            setupFormSubmissions();

            // Toggle switch functionality
            setupToggleSwitches();

            // Button functionality
            setupButtons();

            // Password validation
            setupPasswordValidation();
        });

        // Profile Picture Upload
        function setupProfilePictureUpload() {
            const profilePic = document.getElementById('profile-pic');
            const detailsProfilePic = document.getElementById('details-profile-pic');
            const uploadBtn = document.querySelector('.profile-picture-actions .btn-secondary');
            const removeBtn = document.querySelector('.profile-picture-actions .btn-text');
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/*';
            fileInput.style.display = 'none';
            document.body.appendChild(fileInput);

            // Upload button click
            uploadBtn.addEventListener('click', () => {
                fileInput.click();
            });

            // Profile picture click
            profilePic.addEventListener('click', () => {
                fileInput.click();
            });

            // File selection
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 5 * 1024 * 1024) { // 5MB limit
                        showNotification('File size too large. Please select an image under 5MB.', 'error');
                        return;
                    }
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        profilePic.src = e.target.result;
                        if (detailsProfilePic) detailsProfilePic.src = e.target.result;
                        showNotification('Profile picture updated successfully!', 'success');
                        // Store in localStorage for persistence
                        localStorage.setItem('profilePicture', e.target.result);
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Remove photo
            removeBtn.addEventListener('click', () => {
                profilePic.src = 'images/default-avatar.png';
                if (detailsProfilePic) detailsProfilePic.src = 'images/default-avatar.png';
                localStorage.removeItem('profilePicture');
                showNotification('Profile picture removed.', 'success');
            });

            // Load saved profile picture
            const savedPicture = localStorage.getItem('profilePicture');
            if (savedPicture) {
                profilePic.src = savedPicture;
                if (detailsProfilePic) detailsProfilePic.src = savedPicture;
            }
        }

        // Update user details card live
        function setupUserDetailsCard() {
            const firstName = document.getElementById('first-name');
            const lastName = document.getElementById('last-name');
            const email = document.getElementById('email');
            const bio = document.getElementById('bio');
            const fullNameEl = document.getElementById('details-full-name');
            const emailEl = document.getElementById('details-email');
            const bioEl = document.getElementById('details-bio');

            function updateDetails() {
                if (fullNameEl) fullNameEl.textContent = `${firstName.value} ${lastName.value}`.trim();
                if (emailEl) emailEl.textContent = email.value;
                if (bioEl) bioEl.textContent = bio.value;
            }

            [firstName, lastName, email, bio].forEach(input => {
                if (input) input.addEventListener('input', updateDetails);
            });

            // Initial update
            updateDetails();
        }

        // Form Submissions
        function setupFormSubmissions() {
            document.querySelectorAll('.settings-form').forEach(form => {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    // Validate form
                    if (validateForm(this)) {
                        const submitBtn = this.querySelector('.btn-primary');
                        const originalText = submitBtn.textContent;
                        submitBtn.textContent = 'Saving...';
                        submitBtn.disabled = true;
                        setTimeout(() => {
                            submitBtn.textContent = originalText;
                            submitBtn.disabled = false;
                            showNotification('Settings saved successfully!', 'success');
                            // Save to localStorage with tab context
                            const tabId = this.closest('.settings-tab').id;
                            saveFormData(this, tabId);
                        }, 1500);
                    }
                });
            });
            // Real-time validation for required fields
            document.querySelectorAll('input[required], select[required], textarea[required]').forEach(field => {
                field.addEventListener('blur', function() {
                    if (!this.value.trim()) {
                        this.classList.add('error');
                    } else {
                        this.classList.remove('error');
                    }
                });
                field.addEventListener('input', function() {
                    if (this.value.trim()) {
                        this.classList.remove('error');
                    }
                });
            });
        }

        // Form Validation
        function validateForm(form) {
            const requiredFields = form.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('error');
                    isValid = false;
                } else {
                    field.classList.remove('error');
                }
            });

            // Password validation for security form
            const newPassword = form.querySelector('#new-password');
            const confirmPassword = form.querySelector('#confirm-password');
            
            if (newPassword && confirmPassword && newPassword.value) {
                if (newPassword.value !== confirmPassword.value) {
                    showNotification('Passwords do not match!', 'error');
                    newPassword.classList.add('error');
                    confirmPassword.classList.add('error');
                    isValid = false;
                } else if (newPassword.value.length < 8) {
                    showNotification('Password must be at least 8 characters long!', 'error');
                    newPassword.classList.add('error');
                    isValid = false;
                }
            }
            
            return isValid;
        }

        // Save Form Data per tab
        function saveFormData(form, tabId) {
            const formData = new FormData(form);
            const data = {};
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            localStorage.setItem('userSettings_' + tabId, JSON.stringify(data));
        }

        // Load Form Data for all tabs
        function loadFormData() {
            document.querySelectorAll('.settings-tab').forEach(tab => {
                const tabId = tab.id;
                const savedData = localStorage.getItem('userSettings_' + tabId);
                if (savedData) {
                    const data = JSON.parse(savedData);
                    Object.keys(data).forEach(key => {
                        const field = tab.querySelector(`[name="${key}"]`);
                        if (field) {
                            field.value = data[key];
                        }
                    });
                }
            });
        }

        // Toggle Switches
        function setupToggleSwitches() {
            document.querySelectorAll('.toggle-switch input').forEach(toggle => {
                toggle.addEventListener('change', function() {
                    const parent = this.closest('.notification-option, .privacy-option, .preference-option, .category-option');
                    if (parent) {
                        parent.classList.toggle('active', this.checked);
                    }
                    
                    // Save toggle state
                    const settingName = this.closest('.notification-option, .privacy-option, .preference-option, .category-option').querySelector('h4').textContent;
                    saveToggleState(settingName, this.checked);
                    
                    showNotification(`${settingName} ${this.checked ? 'enabled' : 'disabled'}!`, 'success');
                });
            });

            // Load saved toggle states
            loadToggleStates();
        }

        // Save Toggle State
        function saveToggleState(settingName, state) {
            const toggleStates = JSON.parse(localStorage.getItem('toggleStates') || '{}');
            toggleStates[settingName] = state;
            localStorage.setItem('toggleStates', JSON.stringify(toggleStates));
        }

        // Load Toggle States
        function loadToggleStates() {
            const toggleStates = JSON.parse(localStorage.getItem('toggleStates') || '{}');
            
            document.querySelectorAll('.toggle-switch input').forEach(toggle => {
                const settingName = toggle.closest('.notification-option, .privacy-option, .preference-option, .category-option').querySelector('h4').textContent;
                if (toggleStates.hasOwnProperty(settingName)) {
                    toggle.checked = toggleStates[settingName];
                    const parent = toggle.closest('.notification-option, .privacy-option, .preference-option, .category-option');
                    if (parent) {
                        parent.classList.toggle('active', toggleStates[settingName]);
                    }
                }
            });
        }

        // Button Functionality
        function setupButtons() {
            // Download Data Button
            const downloadBtn = document.querySelector('.action-item .btn-secondary');
            if (downloadBtn) {
                downloadBtn.addEventListener('click', () => {
                    const userData = {
                        profile: JSON.parse(localStorage.getItem('userSettings') || '{}'),
                        toggleStates: JSON.parse(localStorage.getItem('toggleStates') || '{}'),
                        profilePicture: localStorage.getItem('profilePicture'),
                        downloadDate: new Date().toISOString()
                    };
                    
                    const dataStr = JSON.stringify(userData, null, 2);
                    const dataBlob = new Blob([dataStr], {type: 'application/json'});
                    const url = URL.createObjectURL(dataBlob);
                    
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = 'reserve-user-data.json';
                    link.click();
                    
                    URL.revokeObjectURL(url);
                    showNotification('Data downloaded successfully!', 'success');
                });
            }

            // Delete Account Button
            const deleteBtn = document.querySelector('.btn-danger');
            if (deleteBtn) {
                deleteBtn.addEventListener('click', () => {
                    if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                        if (confirm('This will permanently delete all your data. Are you absolutely sure?')) {
                            // Clear all stored data
                            localStorage.clear();
                            showNotification('Account deleted. Redirecting...', 'success');
                            
                            setTimeout(() => {
                                window.location.href = 'index.html';
                            }, 2000);
                        }
                    }
                });
            }

            // Enable 2FA Button
            const twoFABtn = document.querySelector('.security-option .btn-secondary');
            if (twoFABtn) {
                twoFABtn.addEventListener('click', () => {
                    showNotification('Two-factor authentication setup will be implemented soon!', 'info');
                });
            }

            // Connect/Disconnect Social Accounts
            document.querySelectorAll('.account-connection .btn-secondary, .account-connection .btn-text').forEach(btn => {
                btn.addEventListener('click', function() {
                    const isConnected = this.textContent === 'Disconnect';
                    const accountName = this.closest('.account-connection').querySelector('h4').textContent;
                    
                    if (isConnected) {
                        this.textContent = 'Connect';
                        this.classList.remove('btn-text');
                        this.classList.add('btn-secondary');
                        this.closest('.account-connection').querySelector('p').textContent = 'Not connected';
                        showNotification(`${accountName} disconnected!`, 'success');
                    } else {
                        this.textContent = 'Disconnect';
                        this.classList.remove('btn-secondary');
                        this.classList.add('btn-text');
                        this.closest('.account-connection').querySelector('p').textContent = 'Connected for sign-in';
                        showNotification(`${accountName} connected!`, 'success');
                    }
                });
            });

            // View Full History Button
            const historyBtn = document.querySelector('.donation-settings .btn-secondary');
            if (historyBtn) {
                historyBtn.addEventListener('click', () => {
                    showNotification('Donation history feature will be implemented soon!', 'info');
                });
            }
        }

        // Password Validation
        function setupPasswordValidation() {
            const newPassword = document.getElementById('new-password');
            const confirmPassword = document.getElementById('confirm-password');
            
            if (newPassword && confirmPassword) {
                confirmPassword.addEventListener('input', function() {
                    if (newPassword.value && this.value) {
                        if (newPassword.value !== this.value) {
                            this.setCustomValidity('Passwords do not match');
                        } else {
                            this.setCustomValidity('');
                        }
                    }
                });
            }
        }

        // Enhanced Notification System
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas ${getNotificationIcon(type)}"></i>
                    <p>${message}</p>
                    <button class="notification-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            // Set styles based on type
            const colors = {
                success: '#2e8b57',
                error: '#dc3545',
                info: '#17a2b8',
                warning: '#ffc107'
            };
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type]};
                color: white;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.2);
                z-index: 1000;
                animation: slideIn 0.3s ease;
                max-width: 400px;
            `;
            
            document.body.appendChild(notification);
            
            // Close button functionality
            const closeBtn = notification.querySelector('.notification-close');
            closeBtn.addEventListener('click', () => {
                removeNotification(notification);
            });
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                removeNotification(notification);
            }, 5000);
        }

        function removeNotification(notification) {
            notification.style.animation = 'slideOut 0.3s ease';
            setTimeout(() => {
                if (notification.parentNode) {
                    document.body.removeChild(notification);
                }
            }, 300);
        }

        function getNotificationIcon(type) {
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                info: 'fa-info-circle',
                warning: 'fa-exclamation-triangle'
            };
            return icons[type] || icons.success;
        }

        // Load saved data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadFormData();
        });

        // Add CSS animations and styles (only once)
        if (!document.getElementById('settings-notification-style')) {
            const style = document.createElement('style');
            style.id = 'settings-notification-style';
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
                .notification-content {
                    display: flex;
                    align-items: center;
                    gap: 10px;
                }
                .notification-content i:first-child {
                    font-size: 1.2em;
                }
                .notification-close {
                    background: none;
                    border: none;
                    color: white;
                    cursor: pointer;
                    margin-left: auto;
                    padding: 0;
                    font-size: 0.9rem;
                }
                .notification-close:hover {
                    opacity: 0.8;
                }
                .error {
                    border-color: #dc3545 !important;
                    box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.2) !important;
                }
                .btn-primary:disabled {
                    opacity: 0.6;
                    cursor: not-allowed;
                }
                .profile-picture {
                    cursor: pointer;
                }
                .profile-picture:hover {
                    transform: scale(1.05);
                    transition: transform 0.3s ease;
                }
            `;
            document.head.appendChild(style);
        }
    </script>
</body>
</html>